<!DOCTYPE html>
<html lang="en">
<head>
    {% block head %}
        <meta charset="utf-8"/>
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1"/>
        <meta name="renderer" content="webkit"/>
        <meta name="viewport"
              content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
        <meta http-equiv="Cache-Control" content="no-transform"/>
        <meta http-equiv="Cache-Control" content="no-siteapp"/>
        <meta name="keywords"/>
        <meta name="description"/>
        <link rel="shortcut icon" href="{{ url_for('static', filename='img/favicon.png') }}"/>
        <link rel="apple-touch-icon" href="{{ url_for('static', filename='img/apple-touch-icon.png') }}"/>

        <title>{{ post.title }}</title>

        <link rel="stylesheet" href="//cdn.bootcss.com/highlight.js/9.9.0/styles/xcode.min.css"/>
        <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}"/>
        <link rel="stylesheet" href="{{ url_for('static', filename='css/zoomify.min.css') }}"/>
        <script src="//cdn.bootcss.com/jquery/2.2.3/jquery.min.js"></script>
        <script src="{{ url_for('static', filename='js/zoomify.min.js') }}"></script>
        <style>
            .header {
                position: relative;
            }
        </style>

        <!--[if lt IE 9]>
        <script src="//cdn.bootcss.com/html5shiv/r29/html5.min.js"></script>
        <script src="//cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->
    {% endblock head %}
</head>
<body gtools_scp_screen_capture_injected="true">
<!--[if lt IE 8]>
<div class="browsehappy" role="dialog">
    当前网页 <strong>不支持</strong> 你正在使用的浏览器. 为了正常的访问, 请 <a href="http://browsehappy.com/"
                                                       target="_blank">升级你的浏览器</a>。
</div>
<![endif]-->

{% include "header.html" %}

<div id="directory-content" class="directory-content">
    <div id="directory"></div>
</div>
<article class="main-content post-page">
    <div class="post-header">
        <h1 class="post-title" itemprop="name headline">
            <a href="#" data-no-instant="">{{ post.title }}</a>
        </h1>
        <div class="post-data">
            <time datetime="{{ post.created | fmtdate('%Y-%m-%d') }}" itemprop="datePublished">
                发布于 {{ post.created|fmtdate('%Y-%m-%d') }}</time>
            / <a href={{ url_for('.category', cate=post.category.name) }}>{{ post.category.name }}</a>
            / <a href="#">0 条评论</a>
            / 1060浏览
        </div>
    </div>
    <div id="post-content" class="post-content" itemprop="articleBody">
        <p class="post-tags">
            {% for tag in post.tags %}
                <a href="{{ url_for('.show_tag', tag=tag.name) }}">{{ tag.name }}</a>
            {% endfor %}
        </p>
        {{ post.content|markdown }}
        <p class="post-info">
            本站文章除注明转载/出处外，均为本站原创或翻译，转载前请务必署名，转载请标明出处<br/>最后编辑时间为:
            {{ post.modified }}
        </p>
    </div>
</article>

{% include "footer.html" %}

<script>
    /*<![CDATA[*/
    var postDirectoryBuild = function () {
        var postChildren = function children(childNodes, reg) {
                var result = [],
                    isReg = typeof reg === 'object',
                    isStr = typeof reg === 'string',
                    node, i, len;
                for (i = 0, len = childNodes.length; i < len; i++) {
                    node = childNodes[i];
                    if ((node.nodeType === 1 || node.nodeType === 9) &&
                        (!reg ||
                            isReg && reg.test(node.tagName.toLowerCase()) ||
                            isStr && node.tagName.toLowerCase() === reg)) {
                        result.push(node);
                    }
                }
                return result;
            },
            createPostDirectory = function (article, directory, isDirNum) {
                var contentArr = [],
                    titleId = [],
                    levelArr, root, level,
                    currentList, list, li, link, i, len;
                levelArr = (function (article, contentArr, titleId) {
                    var titleElem = postChildren(article.childNodes, /^h\d$/),
                        levelArr = [],
                        lastNum = 1,
                        lastRevNum = 1,
                        count = 0,
                        guid = 1,
                        id = 'directory' + (Math.random() + '').replace(/\D/, ''),
                        num, elem;
                    while (titleElem.length) {
                        elem = titleElem.shift();
                        contentArr.push(elem.innerHTML);
                        num = +elem.tagName.match(/\d/)[0];
                        if (num > lastNum) {
                            levelArr.push(1);
                            lastRevNum += 1;
                        } else if (num === lastRevNum ||
                            num > lastRevNum && num <= lastNum) {
                            levelArr.push(0);
                        } else if (num < lastRevNum) {
                            levelArr.push(num - lastRevNum);
                            lastRevNum = num;
                        }
                        count += levelArr[levelArr.length - 1];
                        lastNum = num;
                        elem.id = elem.id || (id + guid++);
                        titleId.push(elem.id);
                    }
                    if (count !== 0 && levelArr[0] === 1) levelArr[0] = 0;

                    return levelArr;
                })(article, contentArr, titleId);
                currentList = root = document.createElement('ul');
                var dirNum = [0];
                for (i = 0, len = levelArr.length; i < len; i++) {
                    level = levelArr[i];
                    if (level === 1) {
                        list = document.createElement('ul');
                        if (!currentList.lastElementChild) {
                            currentList.appendChild(document.createElement('li'));
                        }
                        currentList.lastElementChild.appendChild(list);
                        currentList = list;
                        dirNum.push(0);
                    } else if (level < 0) {
                        level *= 2;
                        while (level++) {
                            if (level % 2) dirNum.pop();
                            currentList = currentList.parentNode;
                        }
                    }
                    dirNum[dirNum.length - 1]++;
                    li = document.createElement('li');
                    link = document.createElement('a');
                    link.href = '#' + titleId[i];
                    link.innerHTML = !isDirNum ? contentArr[i] :
                        dirNum.join('.') + ' ' + contentArr[i];
                    li.appendChild(link);
                    currentList.appendChild(li);
                }
                directory.appendChild(root);
            };
        createPostDirectory(document.getElementById('post-content'), document.getElementById('directory'), false);
    };
    postDirectoryBuild();
    /*]]>*/
</script>
<script src="//cdn.bootcss.com/headroom/0.9.1/headroom.min.js"></script>
<script src="//cdn.bootcss.com/highlight.js/9.9.0/highlight.min.js"></script>
{#<script src="//cdn.bootcss.com/instantclick/3.0.1/instantclick.min.js"></script>#}
<script>
    var postDirectory = new Headroom(document.getElementById("directory-content"), {
        tolerance: 0,
        offset: 100,
        classes: {
            initial: "initial",
            pinned: "pinned",
            unpinned: "unpinned"
        }
    });
    postDirectory.init();

    $('#search-inp').keypress(function (e) {
        const key = e.which; //e.which是按键的值
        if (key === 13) {
            const q = $(this).val();
            if (q && q !== '') {
                window.location.href = '/search/' + q;
            }
        }
    });

    document.addEventListener('DOMContentLoaded', (event) => {
        document.querySelectorAll('pre code').forEach((block) => {
            hljs.highlightBlock(block);
        });
    });
    (function () {
        let OriginTitile = document.title, titleTime;
        document.addEventListener('visibilitychange', function () {
            if (document.hidden) {
                document.title = 'Luocy`s Blog';
                clearTimeout(titleTime);
            } else {
                document.title = 'Welcome Back! ╮(╯▽╰)╭';
                titleTime = setTimeout(function () {
                    document.title = OriginTitile;
                }, 2000);
            }
        });
    })();
    $('article img').zoomify();
    $(function () {
        if (location.hash) {
            var target = $(location.hash);
            if (target.length === 1) {
                var top = target.offset().top - 60;
                if (top > 0) {
                    $('html,body').animate({scrollTop: top}, 1000);
                }
            }
        }
    });
</script>
</body>
</html>

